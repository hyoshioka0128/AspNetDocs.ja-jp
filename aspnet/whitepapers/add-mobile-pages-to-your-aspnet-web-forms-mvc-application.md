---
uid: whitepapers/add-mobile-pages-to-your-aspnet-web-forms-mvc-application
title: '方法: モバイル ページを追加、ASP.NET Web フォーム/MVC アプリケーション |Microsoft Docs'
author: rick-anderson
description: ここで説明するには、ASP.NET Web フォームからモバイル デバイス用に最適化されたページに提供するさまざまな方法を説明します/MVC アプリケーションでは、し、提案、アーキテクチャとしています.。
ms.author: riande
ms.date: 01/20/2011
ms.assetid: 3124f28e-cc32-418a-afe3-519fa56f4c36
msc.legacyurl: /whitepapers/add-mobile-pages-to-your-aspnet-web-forms-mvc-application
msc.type: content
ms.openlocfilehash: 63c555358d06a9506bb5c8c993800c3307108192
ms.sourcegitcommit: 51b01b6ff8edde57d8243e4da28c9f1e7f1962b2
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 05/06/2019
ms.locfileid: "65114443"
---
# <a name="how-to-add-mobile-pages-to-your-aspnet-web-forms--mvc-application"></a>方法: モバイル ページを ASP.NET Web フォーム / MVC アプリケーションに追加する

> **適用されます。**
> 
> - ASP.NET Web フォームのバージョン 4.0
> - ASP.NET MVC version 3.0
> 
> **まとめ**
> 
> ここで説明するには、ASP.NET Web フォームからモバイル デバイス用に最適化されたページに提供するさまざまな方法を説明します。/MVC アプリケーションでは、幅広い種類のデバイスを対象とするときに考慮すべき問題を設計およびアーキテクチャを示します。 このドキュメントでは、3.5 に ASP.NET 2.0 から ASP.NET モバイル コントロールの旧式である理由と最新の代替手段はいくつかについて説明も説明します。

## <a name="contents"></a>目次

- 概要
- アーキテクチャ上のオプション
- ブラウザーとデバイスの検出
- ASP.NET Web フォーム アプリケーションがモバイル固有のページを表示する方法
- ASP.NET MVC アプリケーションがモバイル固有のページを表示する方法
- その他の技術情報

ASP.NET Web フォームと MVC の両方のこのホワイト ペーパーの手法を示すダウンロード可能なコード サンプルでは、次を参照してください。 [Mobile Apps と ASP.NET を使用したサイト](https://docs.microsoft.com/aspnet/mobile/overview)します。

## <a name="overview"></a>概要

– スマート フォン、機能のスマート フォンやタブレット – モバイル デバイスは、Web にアクセスするための手段として人気の増加を続けます。 つまり多くの web 開発者と企業の web 指向がますます重要に訪問者がこれらのデバイスを使用して、優れた閲覧エクスペリエンスを提供します。

### <a name="how-earlier-versions-of-aspnet-supported-mobile-browsers"></a>サポートされている ASP.NET のモバイル ブラウザーの方法の以前のバージョン

ASP.NET のバージョン 2.0 を 3.5 に含まれる*ASP.NET モバイル コントロール*: でのモバイル デバイス用のサーバー コントロールのセット、 *System.Web.Mobile.dll*アセンブリと*System.Web.UI.MobileControls*名前空間。 ASP.NET 4 のアセンブリが掲載されていますが、非推奨とされます。 開発者は、このホワイト ペーパーで説明したような最新のアプローチに移行することをお勧めします。

なぜ ASP.NET モバイル コントロールは、不使用とマークされている理由は、2005 およびそれ以前の周囲に共通した携帯電話の周囲のデザインを指向することです。 主に、コントロールはその時代 (年号) の WAP ブラウザー (通常の HTML) ではなく、WML または cHTML マークアップを表示するために設計されています。 WAP、cHTML、WML が不要、ほとんどのプロジェクトに関連する HTML がモバイルとデスクトップのブラウザー同様のユビキタス マークアップ言語になるようになりました。

### <a name="the-challenges-of-supporting-mobile-devices-today"></a>モバイル デバイスをサポートしている現在の課題

場合でも、モバイル ブラウザーほぼ例外なくなりました HTML、狙いを定める優れたモバイル閲覧エクスペリエンスを作成するときに、多くの課題が直面します。

- ***画面サイズ***- モバイル デバイスは、フォームが大幅に異なり、各自の画面は、多くの場合はあまりデスクトップ モニターよりも小さくします。 そのため、それらを完全に別のページ レイアウトを設計する必要があります。
- ***入力方式***– 一部のデバイスがあるキーパッド、styluses がある、他のユーザーがタッチを使用します。 複数のナビゲーション メカニズムとデータの入力方法を検討する必要があります。
- ***標準への準拠***– 多くのモバイル ブラウザーは、最新の HTML、CSS、または JavaScript の標準をサポートしていません。
- ***帯域幅***– 携帯データ ネットワークのパフォーマンスが大きく、変化し、一部のエンドユーザーはメガバイト単位で課金される関税率。

汎用型のソリューションはありません。アプリケーションは、外観し、それにアクセスするデバイスに応じて異なる方法で動作する必要があります。 によってモバイル デバイスのサポートのレベルを指定、web 開発者向けに大きな問題、「ブラウザー戦争」desktop がこれまでいたよりも指定できます。

開発者の多くの場合、最初に、初めてのモバイル ブラウザーのサポートに近づいています考えるなどは、開発者が個人的には多くの場合、所有しているために、おそらく、最新で最も高度なスマート フォン (Windows Phone 7、iPhone、または Android など) をサポートするために重要なのみです。デバイス。 ただし、低コストの電話は非常に人気のある、引き続き、その所有者が携帯電話はブロード バンド接続よりも簡単に取得する場所の国で特に – web の閲覧に使用しないでください。 お客様のビジネスがどのようなさまざまな可能性が高い顧客を考慮してサポートするためにデバイスを決定する必要があります。 おそらく性能の低い機能によって、訪問者に対応する必要がありますを映画のチケット予約システムを作成する場合は、高度なスマート フォンをターゲットにのみビジネスの意思決定を行う可能性があります luxury 正常性の spa のオンラインのパンフレットを構築する場合携帯電話です。

## <a name="architectural-options"></a>アーキテクチャ上のオプション

ASP.NET Web フォームまたは MVC の特定の技術的な詳細に入る前に、web 開発者に一般にモバイル ブラウザーをサポートするための 3 つの主な使用可能なオプションがあることに注意してください。

1. ***何もしない –*** 単に標準のデスクトップ指向の web アプリケーションを作成し、期待のレンダリングのモバイル ブラウザーに依存できます。 

    - **利点**:実装および維持 – いいえ付加的な処理を最も安価なオプションです。
    - **欠点**:最悪のエンド ユーザー エクスペリエンスを提供します。 

        - 最新スマート フォンがデスクトップ ブラウザーと同様、HTML をレンダリングする場合がありますが、ユーザーがズームおよびスクロールを水平方向および垂直に小さな画面で、コンテンツを使用するが強制されます。 これは、決して最適です。
        - 満足のいくように、マークアップを表示するために古いデバイスとスマート フォンの機能があります。
        - (その画面はラップトップほど大きくできます) 最新のタブレット デバイス上でもさまざまな相互作用の規則が適用されます。 タッチ ベースの入力がより大きなボタンで最適に動作し、spread さらに、離れているをリンクし、スライド アウト メニューの上をマウス カーソルを移動する方法はありません。
2. ***クライアントで問題を解決*–** CSS を慎重に使用すると、[プログレッシブ エンハンスメント](http://en.wikipedia.org/wiki/Progressive_enhancement)マークアップ、スタイル、および実行は任意のブラウザーに適応するスクリプトを作成することができます。 たとえば、 [3 の CSS メディア クエリ](http://www.w3.org/TR/2010/CR-css3-mediaqueries-20100727/)デバイスの画面が選択されたしきい値より狭い幅を 1 つの列のレイアウトにオンにする複数列のレイアウトを作成できます。 

    - **利点**:に従って、どのような画面や入力の特性がある不明な将来のデバイスの場合でも、使用中の特定のデバイスのレンダリングを最適化します。
    - **利点**:簡単にすべてのデバイスの種類 – コードや作業の重複を最小限の間でサーバー側ロジックを共有することができます。
    - **欠点**:モバイル デバイスが異なる場合があること、モバイル ページは、デスクトップのページから完全に異なるさまざまな情報を示すデスクトップ デバイスの。 このようなバリエーションが非効率になる可能性や確実に実現することは不可能だけで、CSS を使用方法に一貫性がありませんでした特に考慮すると古いデバイスの解釈 CSS 規則。 これは、特に、CSS 3 の属性。
    - **欠点**:さまざまなサーバー側ロジックとワークフローをさまざまなデバイスのサポートを提供しません。 たとえば、CSS だけを使用してモバイル ユーザーの簡略化されたショッピング カート清算ワークフローを実装することはできません。
    - **欠点**:非効率的な帯域幅を使用します。 サーバーは、ターゲット デバイスはその情報のサブセットのみを使用しても、マークアップと、考えられるすべてのデバイスに適用されるスタイルを送信する必要があります。
3. ***サーバー上の問題を解決*–** サーバーがどのようなデバイスがアクセスすることを知っている場合または入力方式は、その画面サイズなど、デバイスの最小の特性と別のロジックを実行できますが – モバイル デバイスであるかどうかと異なる HTML マークアップを出力します。 

    - **に関する利点:** 最大限の柔軟性。 モバイル向けのサーバー側ロジックを変更または、必要に応じて、デバイスに固有のレイアウトのマークアップを最適化する量に制限はありません。
    - **に関する利点:** 効率的な帯域幅を使用します。 のみ、マークアップとスタイル情報を使用しようとして、ターゲット デバイスに送信する必要があります。
    - **短所:** 残存作業時間またはコードの繰り返しを強制的場合があります (例: ため、Web フォーム ページまたは MVC ビューに似ていますが、若干異なるコピーを作成する)。 場所可能な基になる層またはサービスがまだ、して UI コードまたはマークアップの一部に共通のロジックをする要因となりますを複製し、並列で管理し、必要があります。
    - **短所:** デバイスの検出は簡単ではありません。 リストまたは既知のデバイスの種類とその特性 (ができない可能性がある完全に最新の状態) のデータベースが必要ですし、すべての受信要求を正確に一致する保証はありません。 このドキュメントでは、いくつかのオプションとその落とし穴を後で説明します。

最適な結果を得るには、ほとんどの開発者は、オプション (2) と (3) を結合する必要があるを検索します。 サーバー側コードで、データ、ワークフロー、またはマークアップで主な相違点が最も効果的に実装されている一方、若干の違いがスタイルは CSS または偶数の JavaScript を使用して、クライアントで対応最適。

### <a name="this-paper-focuses-on-server-side-techniques"></a>このホワイト ペーパーは、サーバー側の手法

ASP.NET Web フォームと MVC が両方のサーバー側では主にテクノロジであるために、このホワイト ペーパーはサーバー側の手法を異なるマークアップとモバイル ブラウザーのロジックを作成するに焦点します。 もちろん、任意のクライアント側手法 (たとえば、CSS 3 メディア クエリ、プログレッシブ エンハンスメント JavaScript) を結合することもできますが、ASP.NET 開発よりも web デザインの問題よりです。

## <a name="browser-and-device-detection"></a>ブラウザーとデバイスの検出

モバイル デバイスをサポートするためのすべてのサーバー側手法のキーの前提条件は、ビジターを使用してどのようなデバイスを把握することです。 実際には、そのデバイスの製造元とモデルの数を知ることを知ることよりも優れています、*特性*のデバイス。 特性があります。

- モバイル デバイスですか。
- (マウス/キーボード、タッチ、キーボード、ジョイスティック、) の入力メソッド
- 画面のサイズ (物理的にやピクセル単位)
- サポートされているメディアおよびデータの形式
- など。

モデル番号、特性に基づく意思決定することをお勧めし、するとになります将来のデバイスを処理するために装備します。

### <a name="using-aspnets-built-in-browser-detection-support"></a>ASP を使用します。NET の組み込みブラウザー検出のサポート

プロパティを調べることで ASP.NET Web フォームと MVC 開発者が訪問ブラウザーの重要な特性をすぐに検出、 *Request.Browser*オブジェクト。 たとえばを参照してください。

- Request.Browser.IsMobileDevice
- Request.Browser.MobileDeviceManufacturer, Request.Browser.MobileDeviceModel
- Request.Browser.ScreenPixelsWidth
- Request.Browser.SupportsXmlHttp
- ...参照できます他の多くのユーザー

背後では、ASP.NET プラットフォームには、受信が一致する*User-agent* (UA) HTTP ヘッダーをブラウザーの定義 XML ファイルを一連の正規表現を使用します。 既定では、プラットフォームには多くの一般的なモバイル デバイスの定義が含まれていて、他のユーザーが認識するカスタムのブラウザー定義ファイルを追加することができます。 詳細については、MSDN のページを参照してください。 [ASP.NET Web サーバー コントロールとブラウザーの機能](https://msdn.microsoft.com/library/x3k2ssx2.aspx)します。

### <a name="using-the-wurfl-device-database-via-51degreesmobi-foundation"></a>51Degrees.mobi Foundation を使用して、WURFL デバイス データベースを使用します。

ASP の中にします。2 つの主なケースなことができない場合は NET の組み込みブラウザー検出のサポートは、多くのアプリケーションに十分になります。

- ***最新のデバイスを認識する***(なし、手動でそれらのブラウザー定義ファイルの作成) します。 .NET 4 のブラウザー定義ファイルは最新で、Windows Phone 7、Android フォン、Opera Mobile ブラウザー、または Apple Ipad を認識しないことに注意してください。
- ***デバイスの機能についてより詳細な情報が必要な***します。 デバイスの入力メソッド (タッチ vs キーパッドなど) について知っておく必要がありますか、どのようなオーディオ形式のブラウザーをサポートしています。 この情報は、標準のブラウザー定義ファイルでは使用できません。

[ *Wireless Universal Resource ファイル*(WURFL) プロジェクト](http://wurfl.sourceforge.net/)より最新の状態と詳細に関する情報を保持使用しているモバイル デバイス今日です。

.NET 開発者向けのすばらしいは、その ASP します。NET のブラウザーの検出機能は拡張可能な機能を拡張して、これらの問題を克服することができます。 たとえば、オープン ソースを追加することができます[ *51Degrees.mobi Foundation* ](https://github.com/51Degrees/dotNET-Device-Detection)ライブラリをプロジェクトにします。 これは、ASP.NET IHttpModule またはブラウザー機能のプロバイダー (Web フォームと MVC の両方のアプリケーションで使用可能な)、直接 WURFL のデータを読み取り、ASP にフックします。NET の組み込みブラウザー検出メカニズム。 モジュールをインストールしたら*Request.Browser*は突然よりずっと正確かつ詳細な情報が含まれます正しくの前に説明したデバイスの多くを認識し (などの機能を一覧表示。追加機能の入力方式など)。 詳細については、プロジェクトのドキュメントを参照してください。

## <a name="how-web-forms-applications-can-present-mobile-specific-pages"></a>Web フォーム アプリケーションがモバイル固有のページを表示する方法

既定では、次の一般的なモバイル デバイス、新しい Web フォーム アプリケーションを表示する方法に示します。

![](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/_static/image1.png)

明らかに、どちらのレイアウトは非常にモバイル フレンドリ – このページは、縦向きの小さな画面ではなく、規模が大きく、横向きの監視用に設計されました。 それでは何ができることについてでしょうか。

このホワイト ペーパーの前半で説明した、モバイル デバイスの場合、ページを調整するさまざまな方法があります。 一部のテクニックは、サーバー ベース、他のユーザーがクライアントで実行します。

### <a name="creating-a-mobile-specific-master-page"></a>モバイル専用のマスター ページを作成します。

要件に応じて、ことができますを同じ Web フォームを使用して、すべての訪問者が、2 つの異なるマスター ページ: デスクトップの訪問者の 1 つは、モバイル ユーザー用に別の。 これは、ビューでは、CSS スタイル シート、または任意のページ ロジックを複製することを強制することがなく、モバイル デバイスに合わせて、最上位レベルの HTML マークアップを変更する柔軟ができます。

これは、簡単に実行できます。 たとえば、Web フォームに PreInit ハンドラーに次のようを追加できます。

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample1.cs)]

ここで、アプリケーションの最上位フォルダーで Mobile.Master と呼ばれるマスター ページを作成し、モバイル デバイスが検出されたときに使用されます。 モバイル マスター ページは、必要に応じて、モバイル固有の CSS スタイル シートを参照できます。 デスクトップの訪問者には、引き続き既定のマスター ページ、モバイルの 1 つではありませんが表示されます。

### <a name="creating-independent-mobile-specific-web-forms"></a>モバイル専用の独立した Web フォームを作成します。

柔軟性を最大限に高めるできる場合よりも、さまざまなデバイスの種類別のマスター ページに関係なくアクセスします。 2 つを実装することができます*の Web フォーム ページのセットを完全に分離*1 – モバイルの設定別のデスクトップ ブラウザーを設定する。 これは最適モバイルの訪問者に非常に異なる情報、またはワークフローを表示する場合です。 このセクションの残りの部分では、この方法の詳細について説明します。

続行する最も簡単な方法は、プロジェクト内で"Mobile"をという名前のサブフォルダーを作成し、モバイル ページを構築する、デスクトップ ブラウザー用に設計された Web フォーム アプリケーションが既にあると仮定すると、します。 すべてが同じで、他の Web フォーム アプリケーションを使用する手法を使用して、独自のマスター ページ、スタイル シート、およびページで、全体のサブ サイトを構築できます。 モバイルに相当するを生成するために必ずしも*すべて*デスクトップ サイトのページはモバイル閲覧者の機能のサブセットをどのような意味を選択することができます。

モバイル ページは、共通の静的なリソースを共有できます (イメージ、JavaScript、CSS などのファイル) する場合、通常のページでします。 "Mobile"フォルダーがあるため*いない*マークする別のアプリケーションとして (単純な Web フォーム ページのサブフォルダーだけである)、IIS でホストされている場合は共有もまったく同じ構成、セッション データ、およびその他のインフラストラクチャとして、デスクトップのページ。

> [!NOTE]
> この方法では、通常はコードの一部が重複しているため (モバイル ページは、デスクトップのページをいくつかの類似点を共有する可能性の高い、)、一般的なビジネス ロジックまたはデータ アクセス コード共有の基になる層やサービスに排除することが重要です。 それ以外の場合、倍精度浮動小数点の作成と、アプリケーションの保守作業をします。

#### <a name="redirecting-mobile-visitors-to-your-mobile-pages"></a>モバイル ユーザー、モバイル ページにリダイレクトします。

のみ、モバイル ページをモバイル閲覧者にリダイレクトする便利なことがよくあります、*最初*ので、自身のブラウズ セッションで、自身のセッションですべての要求ではなく) を要求します。

- 希望 –「デスクトップ バージョン」に移動するマスター ページのリンクを配置する場合、デスクトップのページにアクセスするモバイル閲覧者を簡単に許可できます。 訪問者は、それがなくなったため、最初の要求のセッションで、モバイル ページにリダイレクトされません。
- (IFRAME では、または特定の Ajax ハンドラーで、サイトのデスクトップとモバイルの両方の部分を表示する一般的な Web フォームがある) 場合などに、サイトのデスクトップおよびモバイルの部分の間で共有するすべての動的リソースの要求が干渉される危険を回避できます。

これを行うには、リダイレクト ロジックを配置することができます、**セッション\_開始**メソッド。 たとえば、Global.asax.cs ファイルに次のメソッドを追加します。

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample2.cs)]

#### <a name="configuring-forms-authentication-to-respect-your-mobile-pages"></a>モバイル ページを尊重するフォーム認証を構成します。

特定の前提条件と、認証プロセスの中にユーザーをリダイレクトできます場所について、フォーム認証することに注意してください。

- ユーザーを認証する場合、フォーム認証にリダイレクトされますにデスクトップまたはモバイル ユーザーいるかどうかに関係なく、デスクトップのログイン ページ (しかの概念がないため、 *1 つ*ログイン URL)。 モバイル ユーザーを別のモバイル ログイン ページにリダイレクトするために、デスクトップのログイン ページを強化するために、モバイルのログイン ページを異なる方法でスタイルを設定すると仮定すると、必要があります。 次のコードを追加するなど、**デスクトップ**ログイン ページのコード ビハインド。 

    [!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample3.cs)]
- 後、ユーザーのログオン成功、フォーム認証は既定でに、デスクトップ ホーム ページにリダイレクト (しかの概念がないため、 *1 つ*既定のページ)。 成功したログの後にモバイル ホーム ページにリダイレクトするために、モバイルのログイン ページを強化する必要があります。 次のコードを追加するなど、**モバイル**ログイン ページのコード ビハインド。 

    [!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample4.cs)]
  
  このコードでは、ページに既定のプロジェクト テンプレートのように、LoginUser と呼ばれるログイン サーバー コントロールが前提としています。

### <a name="working-with-output-caching"></a>出力キャッシュの使用

出力キャッシュを使用している場合は、キャッシュされているデスクトップの出力を受信したモバイル ユーザー続く既定のデスクトップのユーザー (その出力をキャッシュする原因と)、特定の URL に移動することでことに注意してください。 この警告は、デバイスの種類によって、マスター ページのさまざまなまたはデバイスの種類ごとにまったく別の Web フォームを実装しているだけかどうかを適用します。

問題を避けるためには、訪問者がモバイル デバイスを使用しているかどうかに従ってキャッシュ エントリの変更を ASP.NET に指示できます。 ページの OutputCache 宣言するよう VaryByCustom パラメーターを追加します。

[!code-aspx[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample5.aspx)]

次に、定義*isMobileDevice* Global.asax.cs ファイルに次のメソッドを追加することでパラメーターを上書きするカスタムのキャッシュとして。

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample6.cs)]

これにより、ページのモバイル訪問者が以前デスクトップ訪問者によって、キャッシュに格納する出力を受信しないことが保証されます。

### <a name="a-working-example"></a>実際の例

これらの技法の動作を表示するには、ダウンロード[このホワイト ペーパーのコード サンプル](https://docs.microsoft.com/aspnet/mobile/overview)します。 Web フォームのサンプル アプリケーションは、一連の Mobile という名前のサブフォルダー内のモバイル専用のページに自動的にモバイル ユーザーをリダイレクトします。 マークアップとそれらのページのスタイルはより適切に最適化モバイル ブラウザーでは、次のスクリーン ショットからわかるようにします。

![](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/_static/image2.png)

モバイル ブラウザー、マークアップと CSS の最適化の詳細については、「スタイル モバイル ページ モバイル ブラウザーの」このドキュメントの後半のセクションを参照してください。

## <a name="how-aspnet-mvc-applications-can-present-mobile-specific-pages"></a>ASP.NET MVC アプリケーションがモバイル固有のページを表示する方法

モデル-ビュー-コント ローラー パターンが (ビュー) でのプレゼンテーション ロジックから (コント ローラー) でアプリケーション ロジックを分離するため、サーバー側コードでモバイル デバイスのサポートを処理するように、次の方法のいずれかから選択できます。

1. * **デスクトップとモバイルの両方のブラウザーでは、同じコント ローラーとビューを使用して、、デバイスの種類* に応じてさまざまな Razor レイアウトとビューをレンダリングします。** このオプションは、すべてのデバイスで同一のデータを表示しているが、単に別の CSS スタイル シートを指定またはモバイルの最上位レベルの HTML 要素をいくつかを変更する場合に最適です。
2. ***デスクトップとモバイルの両方のブラウザーでは、同じコント ローラーを使用しますが、デバイスの種類に応じて異なるビューをレンダリング***します。 ほぼ同じデータを表示するエンドユーザーのため、同じワークフローを提供する場合、このオプションは最適ですが、使用されているデバイスに合わせて大きく異なる HTML マークアップをレンダリングします。
3. * **デスクトップおよびモバイル ブラウザーでは、それぞれ独立したコント ローラーとビューを実装する別の領域を作成*。** このオプションは、非常にさまざまな画面を表示する、さまざまな情報を含むおよび先頭のユーザー、デバイスの種類用に最適化されたさまざまなワークフローを実行している場合に最適です。 コードのいくつかの繰り返しがありますが、基になるレイヤーやサービスに共通のロジックを切り離すことによって最小化できます。

使用する場合、**最初**オプションを選択し、Razor レイアウトのみを異なるデバイスの種類あたりは非常に簡単です。 変更するだけ、 \_ViewStart.cshtml ファイルの次のようにします。

[!code-cshtml[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample7.cshtml)]

呼ばれるモバイル専用のレイアウトを作成できるようになりました\_ページ構造を持つ LayoutMobile.cshtml と CSS 規則をモバイル デバイス用に最適化します。

使用する場合、 **2 番目**訪問者のデバイスの種類に応じてまったく異なるビューをレンダリング オプションを参照してください[Scott Hanselman のブログの投稿](http://www.hanselman.com/blog/ABetterASPNETMVCMobileDeviceCapabilitiesViewEngine.aspx)します。

このホワイト ペーパーの残りの部分に焦点を当てています、 **3 番目**オプション – 別のコント ローラーを作成する*と*モバイル閲覧者の機能のサブセットが提供される厳密に制御できるようにモバイル デバイスのビュー。

### <a name="setting-up-a-mobile-area-within-your-aspnet-mvc-application"></a>ASP.NET MVC アプリケーション内でのモバイル領域の設定

通常の方法で既存の ASP.NET MVC アプリケーションに"Mobile"と呼ばれる部分を追加することができます。 ソリューション エクスプ ローラーでプロジェクト名を右クリックし、追加比べて領域を選択します。 ASP.NET MVC アプリケーション内の他の任意の領域の場合と同様、し、コント ローラーとビューを追加することができます。 モバイル閲覧者のホーム ページとして機能するテンプレートを使用すると呼ばれる新しいコント ローラーをモバイルお住まいの地域に例を追加します。

### <a name="ensuring-the-url-mobile-reaches-the-mobile-homepage"></a>モバイル ホーム ページ URL/Mobile を確実に到達します。

モバイルお住まいの地域内で HomeController の Index アクションに到達する URL/Mobile を設定する場合は、ルーティングの構成に 2 つの小さな変更を加える必要があります。 最初に、更新、MobileAreaRegistration クラス テンプレートを使用するが、モバイル領域で、既定のコント ローラーように次のコードに示すように。

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample8.cs)]

つまりモバイルのホーム ページは今すぐ配置されている/モバイル ホームではなく、/Mobile で"Home"があるため、モバイル ページの既定のコント ローラー名に暗黙的にします。

次に、こと、2 つ目のテンプレートを使用するアプリケーション (つまり、モバイルは 1 つだけでなく、既存のデスクトップに 1 つ) に追加すると、しますを解除した場合、通常のデスクトップのホームページに注意してください。 これは、エラーで失敗" *'Home' という名前のコント ローラーに一致する複数の種類が見つかりました*"。 これを解決するには、あいまいさがあるときに、デスクトップ、HomeController が優先度を行うことを指定する (Global.asax.cs) で、最上位レベルのルーティング構成を更新します。

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample9.cs)]

退席中、および URL の http エラーになるようになりました:\/\/*目的のサイト*はデスクトップのホーム ページ、および http アクセスは/:\/\/*目的のサイト*/mobile/されますモバイル ホーム ページに到達します。

### <a name="redirecting-mobile-visitors-to-your-mobile-area"></a>モバイルお住まいの地域をモバイル閲覧者にリダイレクトします。

多くのさまざまな機能拡張ポイントがある ASP.NET MVC で可能なリダイレクト ロジックを挿入する方法はたくさんありますので。 1 つの便利なオプションは、属性を作成するフィルターを [RedirectMobileDevicesToMobileArea]、次の条件が満たされた場合、リダイレクトを実行するには。

1. ユーザーのセッションでは最初の要求 (つまり、Session.IsNewSession が true)
2. モバイル ブラウザーから要求を受信 (つまり、Request.Browser.IsMobileDevice が true)
3. ユーザー、モバイル領域内のリソースが既に要求されていない (つまり、*パス*URL の一部が/Mobile で始まらない)

このホワイト ペーパーに含まれているダウンロード可能なサンプルには、このロジックの実装が含まれています。 それ以外の場合であればデスクトップ ビジター最初アクセス特定の URL、デスクトップの出力をキャッシュしてに提供し、可能性がありますも出力キャッシュが使用している場合でもに正しく処理できるは、AuthorizeAttribute から派生した、承認フィルターとして実装されます。その後モバイル ユーザーの場合)。

フィルターは、いずれも使用できますに特定のコント ローラーとアクションを適用する例。

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample10.cs)]

… または、MVC 3 としてすべてのコント ローラーとアクションを適用できます*グローバル フィルター* Global.asax.cs ファイル。

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample11.cs)]

ダウンロード可能なサンプルでは、モバイルお住まいの地域内の特定の場所にリダイレクトするこの属性のサブクラスを作成する方法も示します。 つまり、たとえば、ことができます。

- グローバル フィルターを登録に示すように上記モバイルのホーム ページにモバイル閲覧者を既定で送信します。
- [RedirectMobileDevicesToMobileProductPage] の特殊なフィルターは「製品の表示」アクションを受け取るユーザーが要求したすべての製品ページのモバイル バージョンにモバイル閲覧者にも適用されます。
- フィルターの他の特殊なサブクラスを同等のモバイル ページをモバイル閲覧者にリダイレクトする、特定のアクションにも適用されます。

### <a name="configuring-forms-authentication-to-respect-your-mobile-pages"></a>モバイル ページを尊重するフォーム認証を構成します。

フォーム認証を使用している場合、ことをユーザーにログインする場合、その自動的にユーザー、URL にリダイレクト 1 つ特定「ログオン」は既定では注意してください **/アカウント/ログオン**します。 つまり、デスクトップ「ログオン」アクションをモバイル ユーザーをリダイレクトする場合があります。

この問題を回避するには、モバイル ユーザーをもう一度モバイル「ログオン」のアクションにリダイレクトができるように、デスクトップの「ログオン」アクションにロジックを追加します。 既定の ASP.NET MVC アプリケーション テンプレートを使用している場合は、とおり AccountController のログオン操作を更新します。

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample12.cs)]

… およびモバイルお住まいの地域で AccountController と呼ばれるコント ローラーで適切なモバイル専用「ログオン」アクションを実装します。

### <a name="working-with-output-caching"></a>出力キャッシュの使用

[OutputCache] フィルターを使用している場合は、デバイスの種類によって変化するキャッシュ エントリを強制する必要があります。 たとえば、次のように記述します。

[!code-javascript[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample13.js)]

次に、次のメソッドを Global.asax.cs ファイルに追加します。

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample14.cs)]

これにより、ページのモバイル訪問者が以前デスクトップ訪問者によって、キャッシュに格納する出力を受信しないことが保証されます。

### <a name="a-working-example"></a>実際の例

これらの技法の動作を表示するには、ダウンロード[このホワイト ペーパーのコードには、サンプルが関連付けられている](https://docs.microsoft.com/aspnet/mobile/overview)します。 サンプルには、上記で説明したメソッドを使用してモバイル デバイスをサポートする強化された ASP.NET MVC 3 (リリース候補) アプリケーションが含まれています。

## <a name="further-guidance-and-suggestions"></a>さらにガイダンスと推奨事項

次の説明には、Web フォームと MVC 開発者にとって、このドキュメントで説明する方法を使用している両方が適用されます。

### <a name="enhancing-your-redirection-logic-using-51degreesmobi-foundation"></a>51Degrees.mobi Foundation を使用して、リダイレクト ロジックの強化

このドキュメントに記載するリダイレクト ロジックは、アプリケーションの完全に十分な可能性がありますが、セッションを無効にする必要がある場合は機能しませんか、または特定の要求かどうかはわかりませんので (これらは、セッションを持つことはできません)、cookie を拒否するモバイル ブラウザーでは、そのビジターから最初の 1 つ。

既に、オープン ソース 51Degrees.mobi Foundation ASP の精度が向上する方法について説明しました。NET のブラウザーの検出。 Web.config で構成されている特定の場所をモバイル閲覧者をリダイレクトする組み込み機能もあります。ASP.NET セッションによってことがなく動作することができます (つまり cookie) 訪問者の HTTP ヘッダーと IP アドレスのハッシュの一時的なログを保存すると、それが認識できるように各要求に指定したビジターから 1 つ目がかどうか。

Web.config ファイルの fiftyOne セクションに追加された次の要素が検出されたモバイル デバイスから、ページへの最初の要求をリダイレクト ~/Mobile/Default.aspx します。 モバイルのフォルダーの下のページへの要求は*いない*デバイスの種類に関係なく、リダイレクトされます。 忘れては 20 分間または複数のデバイスの場合は、モバイル デバイスが非アクティブだった期間と、後続の要求はリダイレクトのために新しいものとして扱われます。

[!code-xml[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample15.xml)]

詳細については、次を参照してください。 [51degrees.mobi Foundation ドキュメント](https://github.com/51Degrees/dotNET-Device-Detection)します。

> [!NOTE]
> *できます*51Degrees.mobi Foundation のリダイレクトの機能が、ASP.NET MVC アプリケーションではルーティング パラメーターは使用しませんまたは MVC フィルターを設定することによって、プレーンな Url の観点から、リダイレクト構成を定義する必要がありますアクション。 これはためです (この記事の執筆時点) で 51Degrees.mobi Foundation では、フィルターやルーティングは認識しません。

### <a name="disabling-transcoders-and-proxy-servers"></a>トランスコーダーとプロキシ サーバーを無効にします。

モバイルのインターネットへのアプローチでは、2 つの広範な目標があるモバイル ネットワーク オペレーター。

1. できるだけはるかに関連するコンテンツとして指定します。
2. 制限付きの無線ネットワーク帯域幅を共有できる顧客の数を最大化します。

多くの演算子を使用して、ほとんどの web ページは、デスクトップ サイズの大きい画面と固定行高速ブロード バンド接続用に設計された、ため*トランスコーダー*または*プロキシ サーバー* web コンテンツを動的に変更します。 (特に"フィーチャー フォン用"複雑なレイアウトを処理するために処理能力がない)、小さい画面に合わせて、CSS、HTML マークアップを変更する可能性があり、ページの配信速度を向上させるために (その品質が大幅に軽減)、イメージを再圧縮する可能性があります。

サイトのモバイルに最適化されたバージョンを生成するために作業を実行する可能性がありますしない場合に干渉すること、さらにネットワーク オペレーター。 次の行を追加するには、ページに\_任意の ASP.NET Web フォームでの Load イベント。

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample16.cs)]

または、そのコント ローラー上のすべてのアクションに適用されるため、ASP.NET MVC コント ローラーでは、次のメソッドのオーバーライドを追加する可能性があります。

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample17.cs)]

結果の HTTP メッセージは、W3C 準拠トランスコーダーとコンテンツを変更するには、いないプロキシを通知します。 もちろん、モバイル ネットワーク オペレーターがこのメッセージを尊重する保証はありません。

### <a name="styling-mobile-pages-for-mobile-browsers"></a>モバイル ブラウザー用にモバイル ページのスタイル設定

すばらしい詳細に説明するには、このドキュメントの対象外のどのような HTML マークアップの作業正しくやどの web 設計手法は、特定のデバイスで使いやすさを最大化です。 これがを十分に単純なレイアウトを検索するに用に最適化 mobile サイズの画面では、信頼性の低いを使用せず HTML や CSS のテクニックを配置します。 ただし、触れて、1 つの重要な手法は、*ビューポート メタ タグ*します。

目的のデスクトップ モニターは、残存作業時間表示 web ページで特定最新のモバイル ブラウザー「ビューポート」とも呼ばれる仮想キャンバス上でページのレンダリング (例: 仮想ビューポートは 980 ピクセル幅、iPhone で、既定では、Opera mobile 幅 850 のピクセル) し、画面の物理ピクセルに合わせて、結果のスケール ダウンします。 ユーザーにズーム インし、そのビューポートの周りをパンします。 これには、利点がありますが、ブラウザーで、目的のレイアウト ページを表示できますが、またが、ユーザーにとって便利ですが、ズームとパンを強制的に欠点です。 Mobile を設計する場合は、ある幅の狭い画面をデザインする方がよいズームまたは水平方向にスクロールする必要はありません。

ビューポートは幅は、モバイル ブラウザーに指示する方法は、非標準*ビューポート*メタ タグ。 たとえば、次のページの HEAD セクションに追加します。

[!code-html[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample18.html)]

… 480 ピクセル全体の仮想キャンバス上でページをレイアウトは、スマート フォンのブラウザーをサポートします。 これは、HTML 要素は、割合の幅を定義する場合、割合はこの既定のビューポートの幅は 480 ピクセル幅に関して解釈されることを意味します。 その結果、ユーザーがズームし、パンの水平方向に – 大幅モバイル ブラウジング エクスペリエンスを向上する可能性が低くします。

ビューポートの幅、デバイスの物理ピクセルと一致する場合は、次を指定できます。

[!code-html[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample19.html)]

これを正しく機能させるには、する必要がありますいない明示的に強制する要素をその幅を超える (などを使用して、*幅*属性または CSS プロパティ)、それ以外の場合、ブラウザーでより大きなビューポートを使用して、関係なくで強制されます。 参照してください:[の詳細については、非標準のビューポート タグ](https://developer.apple.com/library/safari/#documentation/AppleApplications/Reference/SafariHTMLRef/Articles/MetaTags.html)します。

ほとんどの最新のスマート フォンをサポートして*双方向の向き*: 縦または横モードでは保持できます。 そのためが推測、画面の幅 (ピクセル単位) が重要です。 でも考えないで、画面の幅が固定されているため、ページ上にあるときに、ユーザーは自分のデバイスを回転再ことができます。

コンテンツに通知するために、ページ ヘッダーには、次のメタ タグ モバイル向けに最適化された、そのため、変換されませんが、古い Windows Mobile、および Blackberry デバイスを受け入れるも可能性があります。

[!code-html[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample20.html)]

## <a name="additional-resources"></a>その他のリソース

一連のモバイル デバイス エミュレーターやシミュレーターの ASP.NET モバイル web アプリケーションをテストに使用できる、ページをご覧ください。[をテストするための一般的なモバイル デバイスをシミュレート](../mobile/device-simulators.md)します。

## <a name="credits"></a>謝辞

- プライマリ作成者:Steven Sanderson
- レビュー担当者]、[その他のライターのコンテンツします。James Rosewell、Mikael Söderström、Scott Hanselman、Scott Hunter
