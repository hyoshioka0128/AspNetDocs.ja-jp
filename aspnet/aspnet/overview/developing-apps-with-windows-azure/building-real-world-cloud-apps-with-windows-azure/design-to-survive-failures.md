---
uid: aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/design-to-survive-failures
title: (Azure で現実世界のクラウド アプリの構築) の障害から復旧する設計 |Microsoft Docs
author: MikeWasson
description: Azure 電子書籍で構築実世界クラウド アプリは、Scott Guthrie が開発したプレゼンテーションに基づいています。 13 のパターンとプラクティスを彼がについて説明しています.
ms.author: riande
ms.date: 06/12/2014
ms.assetid: 364ce84e-5af8-4e08-afc9-75a512b01f84
msc.legacyurl: /aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/design-to-survive-failures
msc.type: authoredcontent
ms.openlocfilehash: fbe618acfc70711933996f97657a4326d389b3dd
ms.sourcegitcommit: 0f1119340e4464720cfd16d0ff15764746ea1fea
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/09/2019
ms.locfileid: "59411242"
---
# <a name="design-to-survive-failures-building-real-world-cloud-apps-with-azure"></a>(Azure で現実世界のクラウド アプリの構築) の障害から復旧する設計します。

によって[Mike Wasson](https://github.com/MikeWasson)、 [Rick Anderson]((https://twitter.com/RickAndMSFT))、 [Tom Dykstra](https://github.com/tdykstra)

[ダウンロードその修正プロジェクト](http://code.msdn.microsoft.com/Fix-It-app-for-Building-cdd80df4)または[電子書籍をダウンロード](http://blogs.msdn.com/b/microsoft_press/archive/2014/07/23/free-ebook-building-cloud-apps-with-microsoft-azure.aspx)

> **構築現実世界の Cloud Apps with Azure**電子書籍は Scott Guthrie が開発したプレゼンテーションに基づきます。 13 のパターンについて説明しするのに役立つプラクティスは、クラウドの web アプリの開発が成功します。 電子書籍の詳細については、次を参照してください。[第 1 章](introduction.md)します。


適切にエラーを処理し、続ける価値を提供するように、アプリを設計する方法は、のアプリケーション、特に 1 つが、多くの人が使用する、クラウドで実行される任意の型を作成する場合について考慮する必要がある点の 1 つとして考えられる。 十分な時間を指定するには、任意の環境または任意のソフトウェア システムで問題が発生する作業がうまきます。 お客様の取得方法感情的とどれ時間だけを決定します、アプリがそのような状況を処理する方法を分析し、問題の修正を使う必要です。

## <a name="types-of-failures"></a>エラーの種類

異なる方法で処理しエラーの 2 つの基本的なカテゴリがあります。

- 一時的なもの、断続的なネットワーク接続の問題などのエラーを自己復旧機能です。
- 介入を必要とするエラーを支えます。

一時的な障害は、最も迅速かつ自動的にアプリが復旧時間のことを確認する再試行ポリシーを実装できます。 お客様には、次のような応答時間が若干長くなる可能性がありますに注意してください、それ以外の場合、影響しません。 これらのエラーを処理するためにいくつかの方法を紹介します、[章の一時的な障害処理](transient-fault-handling.md)します。

不朽のエラーの監視と問題が発生して、根本原因分析を容易にするときにすぐに通知する機能をログ記録を実装できます。 この種のエラーを掌握するためにいくつかの方法を紹介します、 [』 の「監視とテレメトリ](monitoring-and-telemetry.md)します。

## <a name="failure-scope"></a>エラーのスコープ

また、あるな障害の範囲を考慮する 1 台のコンピューターが影響を受けるかどうかなど、SQL Database、Storage、またはリージョン全体の全体のサービスです。

![エラーのスコープ](design-to-survive-failures/_static/image1.png)

### <a name="machine-failures"></a>コンピューターのエラー

Azure では、障害が発生したサーバーに自動的に新しい置き換えられ、自動的かつ迅速に、適切に設計されたクラウド アプリがこの種のエラーから回復します。 ステートレス web 層のスケーラビリティのメリットを強調しました前と、故障したサーバーからの回復性が状態を保持しないという利点もあります。 回復性も SQL Database と Azure App Service Web Apps などのサービスとしてのプラットフォーム (PaaS) 機能の利点の 1 つです。 ハードウェアの障害はまれですが、これらのサービスは、それらを自動的に処理が発生するタイミングこれらのサービスを使用しているときに、コンピューターのエラーを処理するコードを記述する必要はありません。

### <a name="service-failures"></a>サービスの失敗

クラウド アプリは、通常複数のサービスを使用します。 たとえば、Fix It アプリは、SQL Database のサービス、ストレージ サービスを使用してし、を Azure App Service web アプリをデプロイします。 アプリ何に依存するサービスのいずれかが失敗した場合ですか。 エラーをわかりやすいサービスいくつかの「申し訳ありませんが、一度お試しください」メッセージはせいぜいできることになります。 多くのシナリオで行うことができます向上します。 など、バックエンド データ ストアは、ときにユーザー入力を受け付ける、「要求が受け取られて、」を表示して他の任意の場所の入力を一時的に格納必要なサービスが再度、運用し、入力を取得および処理できます。

[キューを中心とした作業パターン](queue-centric-work-pattern.md)章は、このシナリオを処理する方法を示しています。 Fix It アプリでは、SQL Database でタスクが格納されますが、SQL データベースがダウンする際に操作を終了する必要はありません。 その章では、タスクのユーザー入力をキューに格納し、ワーカー プロセスを使用して、キューを読み取って、タスクを更新する方法を表示されます。 SQL は、Fix It タスクを作成する機能は影響を受けません。ワーカー プロセスは待機し、SQL Database が利用可能な場合は、新しいタスクを処理できます。

### <a name="region-failures"></a>リージョン障害

リージョン全体が失敗する可能性があります。 自然災害がデータ センターに壊れる可能性がありますでの meteor フラット化された取得可能性があります、によるなど牛埋没させる farmer によって、データ センターにトランク行を切り取る。アプリが stricken データ センターでホストされている場合は何か。 別のリージョンで実行されているいずれかで障害がある場合は、続行するように、複数のリージョンで同時に実行する Azure でのアプリを設定することになります。 このようなエラーは、非常にまれな出現回数と、ほとんどのアプリは、この種のエラーで中断されないようにサービスを確実に行うための輪をジャンプはありません。 リージョン障害も、使用可能なアプリを保持する方法についての章の末尾には、リソースを参照してください。

Azure の目標は、すべてのこの種のエラーがずっと簡単に処理できるようにして、例をいくつかの方法で作業している、次の章がわかります。

## <a name="slas"></a>Sla

多くの場合、聞く、クラウド環境でのサービス レベル アグリーメント (Sla)。 基本的に、これらは、そのサービスの信頼性に関する約束する企業です。 SLA は、99.9% は、サービスを 99.9% の時間、正しく動作するはずです。 SLA の非常に典型的な値は、非常に大きな数に似ていてどの程度のダウンタイムが気付かない可能性があります。 1% が実際には金額をします。 どの程度のダウンタイムが年、月、および 1 週間に生じるさまざまな SLA の割合を示すテーブルを次に示します。

![SLA テーブル](design-to-survive-failures/_static/image2.png)

したがって、1 年か 43.2 分 1 か月間 8.76 時間を 99.9% の SLA は、サービスを意味考えられます。 よりがダウンしている時間よりも、ほとんどの人を認識 そのため、開発者として、一定量のダウン タイムが可能なことに注意してくださいし、正常な方法で処理します。 アプリを使用する予定はだれかがある時点で、サービスが停止しているしようとするのには、顧客の負の値の影響を最小限にしたいとします。

SLA について知っておくべきことですが、どのような時間枠を指していますはに毎週、毎月、または毎年、クロックはリセットを取得しますか?。 Azure yearly SLA も良いか月間の一連のオフセットで月を非表示にするための年単位の SLA をよりは毎月を時計にリセットします。

もちろん SLA; よりも優れたに求められます常に通常よりもより少ないデータ ダウンできます。 保証が、私たちはこれまで下へのダウン タイムの最大長を超えて場合でも、返金にもらうことができます。 取得おそらく金額は完全に補償たびに、余分のビジネスへの影響が、SLA の側面は、強制ポリシーとして機能し、ことがわかったことは、真剣にすることができます。

### <a name="composite-slas"></a>複合 Sla

Sla の表示されているときに考慮する重要では、アプリケーションでは、複数のサービスを使用して別の SLA を持つ各 service での影響です。 たとえば、Fix It アプリは、Azure App Service Web Apps、Azure Storage、および SQL Database を使用します。 この電子書籍は、2013 年 12 月で記述されている日の時点で、SLA の番号を次に示します。

![Web サイト、ストレージ、SQL Database の SLA](design-to-survive-failures/_static/image3.png)

これらのサービスの Sla に基づくアプリが期待する時間を最大値とは何ですか。 ダウンタイムがある最悪の SLA の割合、または、99.9% 以上この場合と思わ可能性があります。 True の場合は、同時に 3 つすべてのサービスが常に失敗しましたが、それは必ずしも実際の動作。 各サービスが失敗しない個別に、異なるタイミングに複合 SLA を個別の SLA の数値を乗算して計算する必要があるためです。

![複合 SLA](design-to-survive-failures/_static/image4.png)

したがって、アプリは、ダウンしている 43.2 分だけでなく、1 か月が 3 倍になる、1 か月間 – 108 分と Azure SLA の制限内にあります。

この問題は、Azure に固有ではありません。 実際に最適なクラウドの使用可能な任意のクラウド サービスの Sla を提供してと同様の問題、仕入先のクラウド サービスを使用する場合、対処する必要があります。 重要度、顧客やユーザーに影響するほど頻繁に起こる可能性があるため必然的なサービス エラーを適切に処理するアプリを設計する方法についての考え方は、この強調表示します。

### <a name="cloud-slas-compared-to-enterprise-down-time-experience"></a>エンタープライズ ダウン時のエクスペリエンスと比較してクラウドの Sla

"ユーザー場合があります、エンタープライズ アプリは決してあるとこれらの問題" 1 か月間ダウン時間を求める場合が実際にある、作業は、通常は「も、発生場合があります」 認めているどのくらいの頻度を依頼する場合、「をバックアップするか、新しいサーバーまたは update のソフトウェアをインストールする必要はあります」。 もちろん、ダウン時間としてカウントします。 ほとんどのエンタープライズ アプリ特にミッション クリティカルでない限りは実際にはダウン サービスの Sla で許容される時間よりです。 終了時間以下が持つ不安を感じて傾向がありますが、サーバーと、インフラストラクチャとは、そのコントロールを担当する、します。 クラウド環境で他のユーザーに依存しているし、何が起こっては認識しないためより心配を取得する傾向がある可能性があります。

獲得すると、エンタープライズ SLA、クラウドから取得するよりも大きい稼働時間比率、彼らは、ハードウェアをより多くの費用をかけるでします。 クラウド サービスでは、操作を行うことが、そのサービスの多くを請求する必要があります。 代わりに、コスト効率に優れたサービスを活用し、必然的な障害を顧客に最小の中断が発生するように、ソフトウェアを設計します。 クラウド アプリのデザイナーとして、ジョブは、災害の回避に関するエラーを回避するために多くあり、ハードウェアではなく、ソフトウェアに重点を置いたその。 エンタープライズ アプリが平均故障間隔を最大化しようとすると、一方のクラウド アプリは、平均復旧時間を最小限に抑えるに努めています。

### <a name="not-all-cloud-services-have-slas"></a>すべてのクラウド サービスの Sla があります。

了承もいないすべてのクラウド サービスは、SLA をでもが。 アプリが稼働時間の保証はありませんでサービスに依存する場合は、想像よりも長くダウンすることもできます。 たとえば、Facebook や Twitter などのソーシャル プロバイダーを使用して、サイトに、ログで有効にすると場合、SLA があるかどうかを発見する可能性がありますを確認するサービス プロバイダーに確認は 1 つはありません。 ただし、顧客がアプリからロックアウトされた場合は、認証サービスがダウンするか大量の要求をサポートするようになって。 日以上、ダウンする可能性があります。 1 つの新しいアプリの作成者が必要数億のダウンロードとが Facebook 認証 – 依存が遅すぎるライブと検出されたを移行する前に、Facebook に説明しませんでしたをそのサービスの SLA がありません。

### <a name="not-all-downtime-counts-toward-slas"></a>Sla に向けたすべてダウンタイムのカウント

一部のクラウド サービスでは、過剰なアプリで使用する場合、サービスが意図的に拒否します。 これは呼び出されます*調整*します。 サービスに SLA がある場合は、条件は、調整される可能性がある、アプリの設計がそれらの条件を回避しに発生した場合、調整を適切に対処する必要がありますの条件の状態にする必要があります。 たとえば場合は、サービスへの要求を開始できない特定の数/秒を超えると、自動再試行が速すぎて、続行する、調整が発生することが発生しないかどうかを確認します。 調整について取り上げる、[章の一時的な障害処理](transient-fault-handling.md)します。

## <a name="summary"></a>まとめ

この章は、理由、現実世界のクラウド アプリは、障害を適切にから復旧するように設計する必要があります。 を実現できるようにしようとしています。 以降では、 [[次へ] の章](monitoring-and-telemetry.md)、このシリーズでは、それ以外のパターンは、そのために使用できるいくつかの方法の詳細に移動します。

- 良いが[監視とテレメトリ](monitoring-and-telemetry.md)、問題を解決するための十分な情報を使用してすばやくの介入を必要とするエラーの詳細について確認するようにします。
- [一時的な障害処理](transient-fault-handling.md)でき、にフォールバックするときに、アプリが自動的に回復するために、インテリジェントな再試行ロジックを実装することによって[サーキット ブレーカー](transient-fault-handling.md#circuitbreakers)できないときにロジック。
- 使用[分散キャッシュ](distributed-caching.md)データベース アクセスのスループット、待機時間、および接続の問題を最小限に抑えるためにします。
- 実装の疎結合を使用して、[キューを中心とした作業パターン](queue-centric-work-pattern.md)バック エンドが下にあるときに、アプリのフロント エンドを続行するため、します。

## <a name="resources"></a>リソース

詳細については、この電子書籍と、次のリソースの後の章を参照してください。

ドキュメント:

- [フェール セーフ:回復力のあるクラウド アーキテクチャに関するガイダンス](https://msdn.microsoft.com/library/windowsazure/jj853352.aspx)します。 Marc Mercuri、Ulrich Homann、Andrew Townhill してホワイト ペーパー。 フェール セーフ ビデオ シリーズの web ページ バージョンです。
- [Azure Cloud Services で大規模なサービスを設計するためのベスト プラクティス](https://msdn.microsoft.com/library/windowsazure/jj717232.aspx)します。 Mark Simms、Michael Thomassy、ホワイト ペーパー。
- [Azure のビジネス継続性テクニカル ガイダンス](https://msdn.microsoft.com/library/windowsazure/hh873027.aspx)します。 Patrick Wickline、Jason Roth、ホワイト ペーパー。
- [ディザスター リカバリーおよび Azure アプリケーションの高可用性](https://msdn.microsoft.com/library/windowsazure/dn251004.aspx)します。 Michael McKeown、Hanu Kommalapati、Jason Roth、ホワイト ペーパー。
- [Microsoft Patterns and Practices - Azure ガイダンス](https://msdn.microsoft.com/library/dn568099.aspx)します。 複数のデータ センターの展開ガイダンスについては、サーキット ブレーカー パターンを参照してください。
- [Azure サポート - サービス レベル アグリーメント](https://azure.microsoft.com/support/legal/sla/)します。
- [Azure SQL Database におけるビジネス継続性](https://msdn.microsoft.com/library/windowsazure/hh852669.aspx)します。 SQL のデータベース高可用性とディザスター リカバリー機能に関するドキュメントです。
- [高可用性とディザスター リカバリー Azure Virtual Machines における SQL Server の](https://msdn.microsoft.com/library/windowsazure/jj870962.aspx)します。

ビデオ:

- [フェール セーフ:スケーラブルで回復力のあるクラウド サービスの構築](https://channel9.msdn.com/Series/FailSafe)します。 Ulrich Homann、Marc Mercuri、Mark Simms、9 部構成シリーズ。 Microsoft Customer ・ Advisory Team (CAT) の実際の顧客使用経験描画ストーリーと非常にアクセス可能な興味深い方法で高度な概念とアーキテクチャの原則を説明します。 エピソード 1 から 8 は、深さの障害から復旧するクラウド アプリをデザインする理由に移動します。 49:57、障害点と障害モード エピソード 2 から始まる 56:05 でのディスカッションおよびエピソード 3 から始まる 40:55 でサーキット ブレーカーのディスカッションでエピソード 2 の開始時に調整のフォロー アップの説明を参照してください。
- [大規模なビルド。Azure のお客様 - パート II から学んだ教訓](https://channel9.msdn.com/Events/Build/2012/3-030)します。 Mark Simms は、エラーのための設計と、すべてのインストルメント化について説明します。 フェール セーフ シリーズが操作方法の詳細になると似ています。

> [!div class="step-by-step"]
> [前へ](unstructured-blob-storage.md)
> [次へ](monitoring-and-telemetry.md)
